<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Employee Work Tracker</title>
  <style>
    /* Design System */
    :root {
      --color-white: rgba(255, 255, 255, 1);
      --color-black: rgba(0, 0, 0, 1);
      --color-cream-50: rgba(252, 252, 249, 1);
      --color-cream-100: rgba(255, 255, 253, 1);
      --color-gray-200: rgba(245, 245, 245, 1);
      --color-gray-300: rgba(167, 169, 169, 1);
      --color-gray-400: rgba(119, 124, 124, 1);
      --color-slate-500: rgba(98, 108, 113, 1);
      --color-brown-600: rgba(94, 82, 64, 1);
      --color-charcoal-700: rgba(31, 33, 33, 1);
      --color-charcoal-800: rgba(38, 40, 40, 1);
      --color-slate-900: rgba(19, 52, 59, 1);
      --color-teal-300: rgba(50, 184, 198, 1);
      --color-teal-400: rgba(45, 166, 178, 1);
      --color-teal-500: rgba(33, 128, 141, 1);
      --color-teal-600: rgba(29, 116, 128, 1);
      --color-teal-700: rgba(26, 104, 115, 1);
      --color-teal-800: rgba(41, 150, 161, 1);
      --color-red-400: rgba(255, 84, 89, 1);
      --color-red-500: rgba(192, 21, 47, 1);
      --color-orange-400: rgba(230, 129, 97, 1);
      --color-orange-500: rgba(168, 75, 47, 1);
      --color-brown-600-rgb: 94, 82, 64;
      --color-teal-500-rgb: 33, 128, 141;
      --color-slate-900-rgb: 19, 52, 59;
      --color-slate-500-rgb: 98, 108, 113;
      --color-red-500-rgb: 192, 21, 47;
      --color-red-400-rgb: 255, 84, 89;
      --color-orange-500-rgb: 168, 75, 47;
      --color-orange-400-rgb: 230, 129, 97;
      --color-bg-1: rgba(59, 130, 246, 0.08);
      --color-bg-2: rgba(245, 158, 11, 0.08);
      --color-bg-3: rgba(34, 197, 94, 0.08);
      --color-bg-4: rgba(239, 68, 68, 0.08);
      --color-bg-5: rgba(147, 51, 234, 0.08);
      --color-bg-6: rgba(249, 115, 22, 0.08);
      --color-bg-7: rgba(236, 72, 153, 0.08);
      --color-bg-8: rgba(6, 182, 212, 0.08);
      --color-background: var(--color-cream-50);
      --color-surface: var(--color-cream-100);
      --color-text: var(--color-slate-900);
      --color-text-secondary: var(--color-slate-500);
      --color-primary: var(--color-teal-500);
      --color-primary-hover: var(--color-teal-600);
      --color-primary-active: var(--color-teal-700);
      --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
      --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
      --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
      --color-border: rgba(var(--color-brown-600-rgb), 0.2);
      --color-btn-primary-text: var(--color-cream-50);
      --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
      --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
      --color-error: var(--color-red-500);
      --color-success: var(--color-teal-500);
      --color-warning: var(--color-orange-500);
      --color-info: var(--color-slate-500);
      --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
      --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);
      --focus-ring: 0 0 0 3px var(--color-focus-ring);
      --focus-outline: 2px solid var(--color-primary);
      --status-bg-opacity: 0.15;
      --status-border-opacity: 0.25;
      --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      --color-success-rgb: 33, 128, 141;
      --color-error-rgb: 192, 21, 47;
      --color-warning-rgb: 168, 75, 47;
      --color-info-rgb: 98, 108, 113;
      --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      --font-size-xs: 11px;
      --font-size-sm: 12px;
      --font-size-base: 14px;
      --font-size-md: 14px;
      --font-size-lg: 16px;
      --font-size-xl: 18px;
      --font-size-2xl: 20px;
      --font-size-3xl: 24px;
      --font-size-4xl: 30px;
      --font-weight-normal: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 550;
      --font-weight-bold: 600;
      --line-height-tight: 1.2;
      --line-height-normal: 1.5;
      --letter-spacing-tight: -0.01em;
      --space-0: 0;
      --space-1: 1px;
      --space-2: 2px;
      --space-4: 4px;
      --space-6: 6px;
      --space-8: 8px;
      --space-10: 10px;
      --space-12: 12px;
      --space-16: 16px;
      --space-20: 20px;
      --space-24: 24px;
      --space-32: 32px;
      --radius-sm: 6px;
      --radius-base: 8px;
      --radius-md: 10px;
      --radius-lg: 12px;
      --radius-full: 9999px;
      --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
      --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);
      --duration-fast: 150ms;
      --duration-normal: 250ms;
      --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
      --container-sm: 640px;
      --container-md: 768px;
      --container-lg: 1024px;
      --container-xl: 1280px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --color-gray-400-rgb: 119, 124, 124;
        --color-teal-300-rgb: 50, 184, 198;
        --color-gray-300-rgb: 167, 169, 169;
        --color-gray-200-rgb: 245, 245, 245;
        --color-bg-1: rgba(29, 78, 216, 0.15);
        --color-bg-2: rgba(180, 83, 9, 0.15);
        --color-bg-3: rgba(21, 128, 61, 0.15);
        --color-bg-4: rgba(185, 28, 28, 0.15);
        --color-bg-5: rgba(107, 33, 168, 0.15);
        --color-bg-6: rgba(194, 65, 12, 0.15);
        --color-bg-7: rgba(190, 24, 93, 0.15);
        --color-bg-8: rgba(8, 145, 178, 0.15);
        --color-background: var(--color-charcoal-700);
        --color-surface: var(--color-charcoal-800);
        --color-text: var(--color-gray-200);
        --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
        --color-primary: var(--color-teal-300);
        --color-primary-hover: var(--color-teal-400);
        --color-primary-active: var(--color-teal-800);
        --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
        --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
        --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
        --color-border: rgba(var(--color-gray-400-rgb), 0.3);
        --color-error: var(--color-red-400);
        --color-success: var(--color-teal-300);
        --color-warning: var(--color-orange-400);
        --color-info: var(--color-gray-300);
        --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
        --color-btn-primary-text: var(--color-slate-900);
        --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
        --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
        --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
        --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
        --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
        --color-success-rgb: var(--color-teal-300-rgb);
        --color-error-rgb: var(--color-red-400-rgb);
        --color-warning-rgb: var(--color-orange-400-rgb);
        --color-info-rgb: var(--color-gray-300-rgb);
      }
    }

    @font-face {
      font-family: 'FKGroteskNeue';
      src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-family: var(--font-family-base);
      font-size: var(--font-size-base);
      line-height: var(--line-height-normal);
      color: var(--color-text);
      background-color: var(--color-background);
      -webkit-font-smoothing: antialiased;
    }

    body {
      margin: 0;
      padding: var(--space-24);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: var(--font-size-3xl);
      font-weight: var(--font-weight-semibold);
      margin-bottom: var(--space-8);
      color: var(--color-text);
    }

    .subtitle {
      color: var(--color-text-secondary);
      margin-bottom: var(--space-24);
      font-size: var(--font-size-base);
    }

    .card {
      background-color: var(--color-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-card-border);
      box-shadow: var(--shadow-sm);
      padding: var(--space-24);
      margin-bottom: var(--space-24);
    }

    .card h2 {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-semibold);
      margin-bottom: var(--space-16);
      color: var(--color-text);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-16);
      margin-bottom: var(--space-16);
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-8);
      color: var(--color-text);
    }

    input, select, textarea {
      font-family: var(--font-family-base);
      font-size: var(--font-size-base);
      padding: var(--space-8) var(--space-12);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-base);
      background-color: var(--color-surface);
      color: var(--color-text);
      transition: border-color var(--duration-fast) var(--ease-standard);
    }

    input:focus, select:focus, textarea:focus {
      outline: var(--focus-outline);
      border-color: var(--color-primary);
    }

    select {
      appearance: none;
      background-image: var(--select-caret-light);
      background-repeat: no-repeat;
      background-position: right var(--space-12) center;
      background-size: 16px;
      padding-right: var(--space-32);
    }

    @media (prefers-color-scheme: dark) {
      select {
        background-image: var(--select-caret-dark);
      }
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .button-group {
      display: flex;
      gap: var(--space-12);
      margin-top: var(--space-16);
    }

    button {
      font-family: var(--font-family-base);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
      padding: var(--space-10) var(--space-20);
      border: none;
      border-radius: var(--radius-base);
      cursor: pointer;
      transition: all var(--duration-normal) var(--ease-standard);
    }

    .btn-primary {
      background-color: var(--color-primary);
      color: var(--color-btn-primary-text);
    }

    .btn-primary:hover {
      background-color: var(--color-primary-hover);
    }

    .btn-primary:active {
      background-color: var(--color-primary-active);
    }

    .btn-secondary {
      background-color: var(--color-secondary);
      color: var(--color-text);
    }

    .btn-secondary:hover {
      background-color: var(--color-secondary-hover);
    }

    .btn-icon {
      padding: var(--space-6) var(--space-10);
      font-size: var(--font-size-sm);
      background-color: transparent;
      color: var(--color-primary);
      border: 1px solid var(--color-border);
    }

    .btn-icon:hover {
      background-color: var(--color-secondary);
    }

    .btn-danger {
      background-color: transparent;
      color: var(--color-error);
      border: 1px solid var(--color-border);
    }

    .btn-danger:hover {
      background-color: rgba(var(--color-error-rgb), 0.1);
    }

    .filters {
      display: flex;
      gap: var(--space-12);
      margin-bottom: var(--space-16);
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }

    .table-wrapper {
      overflow-x: auto;
      border: 1px solid var(--color-card-border);
      border-radius: var(--radius-base);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-sm);
    }

    thead {
      background-color: var(--color-bg-1);
    }

    th {
      padding: var(--space-12);
      text-align: left;
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      cursor: pointer;
      user-select: none;
      border-bottom: 1px solid var(--color-card-border-inner);
    }

    th:hover {
      background-color: var(--color-bg-2);
    }

    th .sort-indicator {
      margin-left: var(--space-4);
      font-size: var(--font-size-xs);
      color: var(--color-text-secondary);
    }

    td {
      padding: var(--space-12);
      border-bottom: 1px solid var(--color-card-border-inner);
    }

    tbody tr:hover {
      background-color: var(--color-bg-1);
    }

    tfoot {
      background-color: var(--color-bg-3);
      font-weight: var(--font-weight-semibold);
    }

    tfoot td {
      border-bottom: none;
    }

    .status-badge {
      display: inline-block;
      padding: var(--space-4) var(--space-10);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
    }

    .status-transfer {
      background-color: rgba(var(--color-info-rgb), var(--status-bg-opacity));
      color: var(--color-info);
      border: 1px solid rgba(var(--color-info-rgb), var(--status-border-opacity));
    }

    .status-resolve {
      background-color: rgba(var(--color-success-rgb), var(--status-bg-opacity));
      color: var(--color-success);
      border: 1px solid rgba(var(--color-success-rgb), var(--status-border-opacity));
    }

    .status-pma {
      background-color: rgba(var(--color-warning-rgb), var(--status-bg-opacity));
      color: var(--color-warning);
      border: 1px solid rgba(var(--color-warning-rgb), var(--status-border-opacity));
    }

    .status-paa {
      background-color: rgba(var(--color-error-rgb), var(--status-bg-opacity));
      color: var(--color-error);
      border: 1px solid rgba(var(--color-error-rgb), var(--status-border-opacity));
    }

    .action-buttons {
      display: flex;
      gap: var(--space-8);
    }

    .empty-state {
      text-align: center;
      padding: var(--space-32);
      color: var(--color-text-secondary);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: var(--space-16);
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .filters {
        flex-direction: column;
      }

      .filter-group {
        width: 100%;
      }

      table {
        font-size: var(--font-size-xs);
      }

      th, td {
        padding: var(--space-8);
      }

      .action-buttons {
        flex-direction: column;
      }

      button {
        font-size: var(--font-size-sm);
        padding: var(--space-8) var(--space-12);
      }

      #download-message {
        right: 10px;
        left: 10px;
        max-width: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Employee Work Tracker</h1>
    <p class="subtitle">Track case handling time and auxiliary time</p>

    <!-- Warning Banner -->
    <div style="background-color: #FDB022; color: #1F2121; padding: var(--space-12) var(--space-16); border-radius: var(--radius-base); margin-bottom: var(--space-24); display: flex; align-items: center; gap: var(--space-12); border: 1px solid rgba(31, 33, 33, 0.1);">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
      <span style="font-weight: var(--font-weight-medium); font-size: var(--font-size-sm);">‚ö†Ô∏è Data is stored in browser memory. Export your data before closing!</span>
    </div>

    <!-- Work Entry Form -->
    <div class="card">
      <h2 id="form-title">Add Work Entry</h2>
      <form id="work-form">
        <!-- Aux Field (Always visible) -->
        <div class="form-group">
          <label for="aux">Aux *</label>
          <select id="aux" required>
            <option value="">Select Aux</option>
            <option value="Available">Available</option>
            <option value="Project">Project</option>
            <option value="Break">Break</option>
            <option value="Lunch">Lunch</option>
            <option value="System Issue">System Issue</option>
            <option value="Meeting">Meeting</option>
          </select>
          <div id="aux-timer-display" style="display: none; margin-top: var(--space-8); color: var(--color-primary); font-weight: var(--font-weight-semibold); font-size: var(--font-size-base);"></div>
        </div>

        <!-- Comments Field (Only for Aux Mode) -->
        <div class="form-group full-width" id="justification-field" style="display: none;">
          <label for="justification">Comments (optional)</label>
          <textarea id="justification" rows="3" placeholder="Enter comments (optional)"></textarea>
        </div>

        <!-- Case Fields (Only for Available Mode) -->
        <div id="case-fields">
          <!-- Row 1: PSTAM Login, Case ID -->
          <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: var(--space-16);">
            <div class="form-group">
              <label for="pstam-login">PSTAM Login *</label>
              <input type="text" id="pstam-login">
            </div>
            <div class="form-group">
              <label for="case-id">Case ID *</label>
              <input type="text" id="case-id">
            </div>
          </div>
          <!-- Row 2: Start Time, End Time, Case Status, ACHT -->
          <div class="form-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="form-group">
              <label for="start-time">Start Time *</label>
              <input type="text" id="start-time" readonly style="background-color: var(--color-secondary); cursor: not-allowed;" placeholder="Auto-filled">
            </div>
            <div class="form-group">
              <label for="end-time">End Time *</label>
              <input type="text" id="end-time" placeholder="Click to fill">
            </div>
            <div class="form-group">
              <label for="case-status">Case Status *</label>
              <select id="case-status">
                <option value="">Select Status</option>
                <option value="Transfer">Transfer</option>
                <option value="Resolve">Resolve</option>
                <option value="PMA">PMA</option>
                <option value="PAA">PAA</option>
              </select>
            </div>
            <div class="form-group">
              <label for="acht">ACHT (Auto-calculated)</label>
              <input type="text" id="acht" readonly style="background-color: var(--color-secondary); cursor: not-allowed;">
            </div>
          </div>
        </div>
        <div class="button-group">
          <button type="submit" class="btn-primary" id="submit-btn">Add Entry</button>
          <button type="button" class="btn-secondary" id="cancel-btn" style="display: none;">Cancel</button>
        </div>
      </form>
    </div>

    <!-- User Export Button (Accessible to all users) -->
    <div class="card">
      <h2>Export Your Data</h2>
      <p class="subtitle" style="margin-bottom: var(--space-16);">Download your current session data as CSV to prevent data loss.</p>
      <button id="user-export-btn" class="btn-primary" style="display: flex; align-items: center; gap: var(--space-8);">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        üíæ Export My Data
      </button>
    </div>

    <!-- Password Protection Section -->
    <div class="card" id="password-section">
      <h2>View Reports &amp; Data (Admin Only)</h2>
      <p class="subtitle" style="margin-bottom: var(--space-16);">Enter password to access reports, data management, and CSV export. Password: <code style="background-color: var(--color-secondary); padding: 2px 6px; border-radius: var(--radius-sm); font-size: var(--font-size-sm);">Welcome@123</code></p>
      <div id="password-input-container">
        <div style="display: flex; gap: var(--space-12); align-items: flex-end; max-width: 500px;">
          <div class="form-group" style="flex: 1; margin-bottom: 0;">
            <label for="password-input">Password</label>
            <input type="password" id="password-input" placeholder="Enter password" style="width: 100%;">
          </div>
          <button type="button" id="unlock-btn" class="btn-primary" style="white-space: nowrap;">Unlock</button>
        </div>
        <p id="password-error" style="color: var(--color-error); margin-top: var(--space-8); font-size: var(--font-size-sm); display: none;">Incorrect password</p>
      </div>
    </div>

    <!-- Protected Content (Hidden by default) -->
    <div id="protected-content" style="display: none;">

    <!-- Report Summary -->
    <div class="card" id="report-section" style="display: none;">
      <h2>Report Summary</h2>
      <div id="report-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-16);"></div>
    </div>

    <!-- All Entries Table -->
    <div class="card" id="entries-table-card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-16);">
        <h2 style="margin-bottom: 0;">All Entries</h2>
        <button id="export-csv-btn" class="btn-primary" style="display: flex; align-items: center; gap: var(--space-8);">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export to CSV
        </button>
      </div>
      
      <!-- Filters -->
      <div class="filters">
        <div class="filter-group">
          <label for="filter-type">Filter by Type</label>
          <select id="filter-type">
            <option value="">All Types</option>
            <option value="case">Case</option>
            <option value="aux">Aux</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filter-pstam">Filter by PSTAM Login</label>
          <select id="filter-pstam">
            <option value="">All Logins</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filter-status">Filter by Case Status</label>
          <select id="filter-status">
            <option value="">All Statuses</option>
            <option value="Transfer">Transfer</option>
            <option value="Resolve">Resolve</option>
            <option value="PMA">PMA</option>
            <option value="PAA">PAA</option>
          </select>
        </div>
      </div>

      <!-- Table -->
      <div class="table-wrapper">
        <table id="work-table">
          <thead>
            <tr>
              <th data-sort="type">Type <span class="sort-indicator">‚Üï</span></th>
              <th data-sort="aux">Aux <span class="sort-indicator">‚Üï</span></th>
              <th>PSTAM Login</th>
              <th>Case ID</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Status</th>
              <th>ACHT</th>
              <th>Duration</th>
              <th>Comments</th>
              <th data-sort="timestamp">Time <span class="sort-indicator">‚Üï</span></th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="work-entries">
            <tr>
              <td colspan="12" class="empty-state">No entries yet. Add your first entry above.</td>
            </tr>
          </tbody>
          <tfoot id="summary-footer" style="display: none;">
          </tfoot>
        </table>
      </div>
    </div>

    </div><!-- End Protected Content -->
  </div>

  <script>
    // Password and unlock state
    const CORRECT_PASSWORD = 'Welcome@123';
    let isUnlocked = false;

    // Aux timer variables - TIMESTAMP-BASED for persistence
    let auxTimerInterval = null;
    let auxStartTime = null; // Store Date.now() when timer starts
    let auxPausedDuration = 0; // Store any paused time in milliseconds
    let currentAuxTime = '00:00:00';

    // In-memory data storage
    let workEntries = [];
    let editingIndex = null;
    let sortColumn = null;
    let sortDirection = 'asc';

    // Form elements
    const form = document.getElementById('work-form');
    const formTitle = document.getElementById('form-title');
    const submitBtn = document.getElementById('submit-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const caseIdInput = document.getElementById('case-id');
    const pstamLoginInput = document.getElementById('pstam-login');
    const startTimeInput = document.getElementById('start-time');
    const endTimeInput = document.getElementById('end-time');
    const caseStatusInput = document.getElementById('case-status');
    const achtInput = document.getElementById('acht');
    const auxInput = document.getElementById('aux');
    const auxTimerDisplay = document.getElementById('aux-timer-display');
    const justificationField = document.getElementById('justification-field');
    const justificationInput = document.getElementById('justification');
    const caseFields = document.getElementById('case-fields');

    // Filter elements
    const filterType = document.getElementById('filter-type');
    const filterPstam = document.getElementById('filter-pstam');
    const filterStatus = document.getElementById('filter-status');

    // Table elements
    const workEntriesBody = document.getElementById('work-entries');
    const summaryFooter = document.getElementById('summary-footer');

    // Format current time as HH:MM:SS AM/PM
    function getCurrentTimeFormatted() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12; // 0 should be 12
      const hoursStr = String(hours).padStart(2, '0');
      return `${hoursStr}:${minutes}:${seconds} ${ampm}`;
    }

    // Parse time string (HH:MM:SS AM/PM) to Date object
    function parseTimeString(timeStr) {
      const match = timeStr.match(/(\d{1,2}):(\d{2}):(\d{2})\s*(AM|PM)/i);
      if (!match) return null;
      
      let hours = parseInt(match[1]);
      const minutes = parseInt(match[2]);
      const seconds = parseInt(match[3]);
      const ampm = match[4].toUpperCase();
      
      if (ampm === 'PM' && hours !== 12) hours += 12;
      if (ampm === 'AM' && hours === 12) hours = 0;
      
      const date = new Date();
      date.setHours(hours, minutes, seconds, 0);
      return date;
    }

    // Calculate ACHT from start and end times
    function calculateACHT(startTime, endTime) {
      if (!startTime || !endTime) return '';
      
      const start = parseTimeString(startTime);
      const end = parseTimeString(endTime);
      
      if (!start || !end) return '';
      
      let diffMs = end - start;
      if (diffMs < 0) diffMs += 24 * 60 * 60 * 1000; // Handle overnight
      
      const totalSeconds = Math.floor(diffMs / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Format milliseconds to HH:MM:SS
    function formatMillisecondsToTime(totalMs) {
      const totalSeconds = Math.floor(totalMs / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Format seconds to HH:MM:SS
    function formatSecondsToTime(totalSeconds) {
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Start Aux Timer - TIMESTAMP-BASED for persistence across tab switches
    function startAuxTimer() {
      stopAuxTimer(); // Clear any existing timer
      
      // Store the start timestamp
      auxStartTime = Date.now();
      auxPausedDuration = 0;
      
      auxTimerDisplay.style.display = 'block';
      auxTimerDisplay.textContent = 'Aux Timer: 00:00:00';
      
      // Update display by calculating from timestamp
      auxTimerInterval = setInterval(() => {
        if (auxStartTime !== null) {
          const elapsed = Date.now() - auxStartTime + auxPausedDuration;
          currentAuxTime = formatMillisecondsToTime(elapsed);
          auxTimerDisplay.textContent = `Aux Timer: ${currentAuxTime}`;
        }
      }, 1000);
      
      // Trigger immediate update
      if (auxStartTime !== null) {
        const elapsed = Date.now() - auxStartTime + auxPausedDuration;
        currentAuxTime = formatMillisecondsToTime(elapsed);
        auxTimerDisplay.textContent = `Aux Timer: ${currentAuxTime}`;
      }
    }

    // Stop Aux Timer
    function stopAuxTimer() {
      if (auxTimerInterval) {
        clearInterval(auxTimerInterval);
        auxTimerInterval = null;
      }
      
      if (auxStartTime !== null) {
        // Calculate final elapsed time from timestamp
        const elapsed = Date.now() - auxStartTime + auxPausedDuration;
        const recordedTime = formatMillisecondsToTime(elapsed);
        auxTimerDisplay.textContent = `Aux Time Recorded: ${recordedTime}`;
        
        setTimeout(() => {
          auxTimerDisplay.style.display = 'none';
          auxTimerDisplay.textContent = '';
          auxStartTime = null;
          auxPausedDuration = 0;
          currentAuxTime = '00:00:00';
        }, 3000);
      } else {
        auxTimerDisplay.style.display = 'none';
        auxTimerDisplay.textContent = '';
        currentAuxTime = '00:00:00';
      }
    }

    // Reset Aux Timer
    function resetAuxTimer() {
      if (auxTimerInterval) {
        clearInterval(auxTimerInterval);
        auxTimerInterval = null;
      }
      auxStartTime = null;
      auxPausedDuration = 0;
      currentAuxTime = '00:00:00';
      auxTimerDisplay.style.display = 'none';
      auxTimerDisplay.textContent = '';
    }

    // Aux dropdown change handler - Dynamic form switching
    auxInput.addEventListener('change', function() {
      const auxValue = this.value;
      
      if (auxValue && auxValue !== 'Available') {
        // AUX MODE: Hide case fields, show justification, start timer
        caseFields.style.display = 'none';
        justificationField.style.display = 'block';
        
        // Remove required from case fields
        pstamLoginInput.removeAttribute('required');
        caseIdInput.removeAttribute('required');
        startTimeInput.removeAttribute('required');
        endTimeInput.removeAttribute('required');
        caseStatusInput.removeAttribute('required');
        
        formTitle.textContent = 'Add Aux Entry';
        startAuxTimer();
      } else if (auxValue === 'Available') {
        // CASE MODE: Show case fields, hide justification, stop timer
        caseFields.style.display = 'block';
        justificationField.style.display = 'none';
        
        // Add required to case fields
        pstamLoginInput.setAttribute('required', 'required');
        caseIdInput.setAttribute('required', 'required');
        startTimeInput.setAttribute('required', 'required');
        endTimeInput.setAttribute('required', 'required');
        caseStatusInput.setAttribute('required', 'required');
        
        formTitle.textContent = 'Add Case Entry';
        stopAuxTimer();
      } else {
        // No selection: Hide both
        caseFields.style.display = 'none';
        justificationField.style.display = 'none';
        formTitle.textContent = 'Add Work Entry';
        resetAuxTimer();
      }
    });

    // Auto-fill Start Time when Case ID is entered
    caseIdInput.addEventListener('input', function() {
      if (this.value.trim() && !startTimeInput.value && editingIndex === null) {
        startTimeInput.value = getCurrentTimeFormatted();
        updateACHT();
      }
    });

    // Auto-fill End Time when clicked
    endTimeInput.addEventListener('click', function() {
      this.value = getCurrentTimeFormatted();
      updateACHT();
    });

    // Auto-calculate ACHT when times change
    function updateACHT() {
      const acht = calculateACHT(startTimeInput.value, endTimeInput.value);
      achtInput.value = acht;
    }

    endTimeInput.addEventListener('input', updateACHT);

    // Form submission
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const auxValue = auxInput.value;
      let entry;
      
      if (auxValue && auxValue !== 'Available') {
        // AUX MODE ENTRY
        const duration = currentAuxTime;
        const comments = justificationInput.value.trim();
        const timestamp = getCurrentTimeFormatted();
        
        entry = {
          type: 'aux',
          aux: auxValue,
          duration: duration,
          comments: comments,
          timestamp: timestamp
        };
        
        stopAuxTimer();
      } else if (auxValue === 'Available') {
        // CASE MODE ENTRY
        // Validate times
        if (!startTimeInput.value || !endTimeInput.value) {
          alert('Please enter both start and end times');
          return;
        }
        
        if (!pstamLoginInput.value.trim() || !caseIdInput.value.trim() || !caseStatusInput.value) {
          alert('Please fill in all required fields');
          return;
        }

        const acht = calculateACHT(startTimeInput.value, endTimeInput.value);
        const timestamp = getCurrentTimeFormatted();
        
        entry = {
          type: 'case',
          aux: 'Available',
          pstam: pstamLoginInput.value.trim(),
          caseid: caseIdInput.value.trim(),
          stime: startTimeInput.value,
          etime: endTimeInput.value,
          cs: caseStatusInput.value,
          acht: acht,
          timestamp: timestamp
        };
      } else {
        alert('Please select an Aux option');
        return;
      }

      if (editingIndex !== null) {
        // Update existing entry
        workEntries[editingIndex] = entry;
        editingIndex = null;
        formTitle.textContent = 'Add Work Entry';
        submitBtn.textContent = 'Add Entry';
        cancelBtn.style.display = 'none';
      } else {
        // Add new entry
        workEntries.push(entry);
      }

      form.reset();
      resetAuxTimer();
      
      // Reset form to default state
      caseFields.style.display = 'none';
      justificationField.style.display = 'none';
      formTitle.textContent = 'Add Work Entry';
      
      updatePstamFilter();
      renderTable();
      renderReport();
    });

    // Cancel editing
    cancelBtn.addEventListener('click', function() {
      editingIndex = null;
      form.reset();
      resetAuxTimer();
      
      // Reset form to default state
      caseFields.style.display = 'none';
      justificationField.style.display = 'none';
      formTitle.textContent = 'Add Work Entry';
      submitBtn.textContent = 'Add Entry';
      cancelBtn.style.display = 'none';
    });

    // Edit entry
    function editEntry(index) {
      const entry = workEntries[index];
      editingIndex = index;
      
      if (entry.type === 'aux') {
        // Edit aux entry
        auxInput.value = entry.aux;
        justificationInput.value = entry.comments || '';
        
        // Show aux mode
        caseFields.style.display = 'none';
        justificationField.style.display = 'block';
        
        formTitle.textContent = 'Edit Aux Entry';
      } else {
        // Edit case entry
        auxInput.value = entry.aux;
        pstamLoginInput.value = entry.pstam;
        caseIdInput.value = entry.caseid;
        startTimeInput.value = entry.stime;
        endTimeInput.value = entry.etime;
        caseStatusInput.value = entry.cs;
        achtInput.value = entry.acht;
        
        // Show case mode
        caseFields.style.display = 'block';
        justificationField.style.display = 'none';
        
        formTitle.textContent = 'Edit Case Entry';
      }

      submitBtn.textContent = 'Update Entry';
      cancelBtn.style.display = 'inline-block';

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Delete entry
    function deleteEntry(index) {
      if (confirm('Are you sure you want to delete this entry?')) {
        workEntries.splice(index, 1);
        updatePstamFilter();
        renderTable();
        renderReport();
      }
    }

    // Update PSTAM filter dropdown
    function updatePstamFilter() {
      const pstamLogins = [...new Set(workEntries.filter(e => e.type === 'case').map(e => e.pstam))].sort();
      const currentValue = filterPstam.value;
      
      filterPstam.innerHTML = '<option value="">All Logins</option>';
      pstamLogins.forEach(login => {
        const option = document.createElement('option');
        option.value = login;
        option.textContent = login;
        filterPstam.appendChild(option);
      });
      
      if (pstamLogins.includes(currentValue)) {
        filterPstam.value = currentValue;
      }
    }

    // Filter entries
    function getFilteredEntries() {
      return workEntries.filter(entry => {
        // Type filter
        const typeMatch = !filterType.value || entry.type === filterType.value;
        
        if (entry.type === 'aux') {
          return typeMatch;
        }
        
        // Case entries: apply PSTAM and status filters
        const pstamMatch = !filterPstam.value || entry.pstam === filterPstam.value;
        const statusMatch = !filterStatus.value || entry.cs === filterStatus.value;
        return typeMatch && pstamMatch && statusMatch;
      });
    }

    // Sort entries
    function sortEntries(entries, column, direction) {
      return [...entries].sort((a, b) => {
        let aVal, bVal;
        
        switch(column) {
          case 'type':
            aVal = a.type;
            bVal = b.type;
            break;
          case 'aux':
            aVal = a.aux;
            bVal = b.aux;
            break;
          case 'timestamp':
            aVal = a.timestamp;
            bVal = b.timestamp;
            break;
          default:
            return 0;
        }

        if (aVal < bVal) return direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return direction === 'asc' ? 1 : -1;
        return 0;
      });
    }

    // Render table
    function renderTable() {
      let entries = getFilteredEntries();
      
      if (sortColumn) {
        entries = sortEntries(entries, sortColumn, sortDirection);
      }

      workEntriesBody.innerHTML = '';

      if (entries.length === 0) {
        workEntriesBody.innerHTML = '<tr><td colspan="12" class="empty-state">No matching entries found.</td></tr>';
        summaryFooter.style.display = 'none';
        return;
      }

      entries.forEach((entry, displayIndex) => {
        const originalIndex = workEntries.indexOf(entry);
        const row = document.createElement('tr');
        
        if (entry.type === 'aux') {
          // Aux entry row
          row.innerHTML = `
            <td><span class="status-badge status-info">Aux</span></td>
            <td>${entry.aux}</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>${entry.duration}</td>
            <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${entry.comments || '-'}">${entry.comments || '-'}</td>
            <td>${entry.timestamp}</td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" onclick="editEntry(${originalIndex})">Edit</button>
                <button class="btn-danger" onclick="deleteEntry(${originalIndex})">Delete</button>
              </div>
            </td>
          `;
        } else {
          // Case entry row
          const statusClass = entry.cs.replace(/\s+/g, '').toLowerCase();
          row.innerHTML = `
            <td><span class="status-badge status-success">Case</span></td>
            <td>${entry.aux}</td>
            <td>${entry.pstam}</td>
            <td>${entry.caseid}</td>
            <td>${entry.stime}</td>
            <td>${entry.etime}</td>
            <td><span class="status-badge status-${statusClass}">${entry.cs}</span></td>
            <td>${entry.acht}</td>
            <td>-</td>
            <td>-</td>
            <td>${entry.timestamp}</td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" onclick="editEntry(${originalIndex})">Edit</button>
                <button class="btn-danger" onclick="deleteEntry(${originalIndex})">Delete</button>
              </div>
            </td>
          `;
        }
        
        workEntriesBody.appendChild(row);
      });

      renderSummary(entries);
    }

    // Convert HH:MM to minutes
    function timeToMinutes(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return hours * 60 + minutes;
    }

    // Convert minutes to HH:MM
    function minutesToTime(minutes) {
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
    }

    // Render summary footer
    function renderSummary(entries) {
      summaryFooter.innerHTML = '';
      
      if (entries.length > 0) {
        summaryFooter.style.display = 'table-footer-group';
        
        // Calculate totals
        const auxEntries = entries.filter(e => e.type === 'aux');
        const caseEntries = entries.filter(e => e.type === 'case');
        
        let totalACHTMinutes = 0;
        caseEntries.forEach(entry => {
          totalACHTMinutes += timeToMinutes(entry.acht);
        });
        const totalACHT = minutesToTime(totalACHTMinutes);
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td colspan="4"><strong>Total Entries: ${entries.length} (${caseEntries.length} Cases, ${auxEntries.length} Aux)</strong></td>
          <td colspan="3"></td>
          <td><strong>${totalACHT}</strong></td>
          <td colspan="4"></td>
        `;
        summaryFooter.appendChild(row);
      } else {
        summaryFooter.style.display = 'none';
      }
    }

    // Sort table on header click
    document.querySelectorAll('th[data-sort]').forEach(header => {
      header.addEventListener('click', function() {
        const column = this.dataset.sort;
        
        if (sortColumn === column) {
          sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
        } else {
          sortColumn = column;
          sortDirection = 'asc';
        }

        // Update sort indicators
        document.querySelectorAll('th[data-sort] .sort-indicator').forEach(indicator => {
          indicator.textContent = '‚Üï';
        });
        
        const indicator = this.querySelector('.sort-indicator');
        indicator.textContent = sortDirection === 'asc' ? '‚Üë' : '‚Üì';

        renderTable();
      });
    });

    // Filter change listeners
    filterType.addEventListener('change', () => {
      renderTable();
      renderReport();
    });
    filterPstam.addEventListener('change', () => {
      renderTable();
      renderReport();
    });
    filterStatus.addEventListener('change', () => {
      renderTable();
      renderReport();
    });

    // Make functions globally accessible
    window.editEntry = editEntry;
    window.deleteEntry = deleteEntry;

    // Password unlock functionality
    const passwordInput = document.getElementById('password-input');
    const unlockBtn = document.getElementById('unlock-btn');
    const passwordError = document.getElementById('password-error');
    const passwordInputContainer = document.getElementById('password-input-container');
    const protectedContent = document.getElementById('protected-content');
    const passwordSection = document.getElementById('password-section');

    function unlockProtectedContent() {
      const enteredPassword = passwordInput.value;
      
      if (enteredPassword === CORRECT_PASSWORD) {
        isUnlocked = true;
        passwordError.style.display = 'none';
        passwordInputContainer.style.display = 'none';
        protectedContent.style.display = 'block';
        
        // Update password section to show success message
        const successMessage = document.createElement('div');
        successMessage.style.cssText = 'padding: var(--space-16); background-color: var(--color-bg-3); border-radius: var(--radius-base); border: 1px solid rgba(var(--color-success-rgb), 0.3);';
        successMessage.innerHTML = `
          <div style="display: flex; align-items: center; gap: var(--space-12);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span style="color: var(--color-success); font-weight: var(--font-weight-medium);">Access granted. You can now view and manage all data.</span>
          </div>
        `;
        passwordSection.querySelector('h2').insertAdjacentElement('afterend', successMessage);
        
        // Render the protected content
        renderTable();
        renderReport();
      } else {
        passwordError.style.display = 'block';
        passwordInput.value = '';
        passwordInput.focus();
      }
    }

    unlockBtn.addEventListener('click', unlockProtectedContent);
    
    passwordInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        unlockProtectedContent();
      }
    });

    // Render detailed report
    function renderReport() {
      const reportSection = document.getElementById('report-section');
      const reportContent = document.getElementById('report-content');
      
      const entries = getFilteredEntries();
      
      if (entries.length === 0) {
        reportSection.style.display = 'none';
        return;
      }
      
      reportSection.style.display = 'block';
      
      // Separate entries by type
      const auxEntries = entries.filter(e => e.type === 'aux');
      const caseEntries = entries.filter(e => e.type === 'case');
      
      // Calculate statistics
      const statusCounts = {};
      const auxTypeCounts = {};
      let totalACHTMinutes = 0;
      
      // Count case statuses
      caseEntries.forEach(entry => {
        statusCounts[entry.cs] = (statusCounts[entry.cs] || 0) + 1;
        totalACHTMinutes += timeToMinutes(entry.acht);
      });
      
      // Count aux types
      auxEntries.forEach(entry => {
        auxTypeCounts[entry.aux] = (auxTypeCounts[entry.aux] || 0) + 1;
      });
      
      const totalACHT = minutesToTime(totalACHTMinutes);
      
      // Build report HTML
      let reportHTML = '';
      
      // Total Entries Card
      reportHTML += `
        <div style="background-color: var(--color-bg-1); padding: var(--space-16); border-radius: var(--radius-base); border: 1px solid var(--color-card-border);">
          <h3 style="font-size: var(--font-size-base); font-weight: var(--font-weight-medium); margin-bottom: var(--space-8); color: var(--color-text-secondary);">Total Entries</h3>
          <p style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); margin: 0; color: var(--color-text);">${entries.length}</p>
          <p style="font-size: var(--font-size-sm); margin-top: var(--space-4); color: var(--color-text-secondary);">${caseEntries.length} Cases | ${auxEntries.length} Aux</p>
        </div>
      `;
      
      // Total ACHT Card
      reportHTML += `
        <div style="background-color: var(--color-bg-3); padding: var(--space-16); border-radius: var(--radius-base); border: 1px solid var(--color-card-border);">
          <h3 style="font-size: var(--font-size-base); font-weight: var(--font-weight-medium); margin-bottom: var(--space-8); color: var(--color-text-secondary);">Total ACHT</h3>
          <p style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); margin: 0; color: var(--color-text);">${totalACHT}</p>
        </div>
      `;
      
      // Case Status Breakdown Card
      reportHTML += `
        <div style="background-color: var(--color-bg-5); padding: var(--space-16); border-radius: var(--radius-base); border: 1px solid var(--color-card-border); grid-column: span 1;">
          <h3 style="font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-12); color: var(--color-text);">Cases by Status</h3>
          <div style="display: flex; flex-direction: column; gap: var(--space-8);">
      `;
      
      ['Transfer', 'Resolve', 'PMA', 'PAA'].forEach(status => {
        const count = statusCounts[status] || 0;
        reportHTML += `
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--color-text); font-size: var(--font-size-sm);">${status}</span>
            <span style="color: var(--color-text); font-weight: var(--font-weight-semibold); font-size: var(--font-size-base);">${count}</span>
          </div>
        `;
      });
      
      reportHTML += `
          </div>
        </div>
      `;
      
      // Aux Type Breakdown Card
      reportHTML += `
        <div style="background-color: var(--color-bg-6); padding: var(--space-16); border-radius: var(--radius-base); border: 1px solid var(--color-card-border); grid-column: span 1;">
          <h3 style="font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-12); color: var(--color-text);">Aux Type Breakdown</h3>
          <div style="display: flex; flex-direction: column; gap: var(--space-8);">
      `;
      
      ['Project', 'Break', 'Lunch', 'System Issue', 'Meeting'].forEach(auxType => {
        const count = auxTypeCounts[auxType] || 0;
        reportHTML += `
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--color-text); font-size: var(--font-size-sm);">${auxType}</span>
            <span style="color: var(--color-text); font-weight: var(--font-weight-semibold); font-size: var(--font-size-base);">${count}</span>
          </div>
        `;
      });
      
      reportHTML += `
          </div>
        </div>
      `;
      
      reportContent.innerHTML = reportHTML;
    }

    // Export to CSV functionality
    function exportToCSV() {
      if (workEntries.length === 0) {
        alert('No data to export. Please add some entries first.');
        return;
      }

      try {
        // CSV Headers - include all possible fields
        const headers = ['Type', 'Aux', 'PSTAM Login', 'Case ID', 'Start Time', 'End Time', 'Case Status', 'ACHT', 'Duration', 'Comments', 'Timestamp'];
        
        // Escape function for CSV values
        function escapeCSV(value) {
          if (value === null || value === undefined) return '';
          const stringValue = String(value);
          // If value contains comma, quote, or newline, wrap in quotes and escape quotes
          if (stringValue.includes(',') || stringValue.includes('"') || stringValue.includes('\n')) {
            return '"' + stringValue.replace(/"/g, '""') + '"';
          }
          return stringValue;
        }
        
        // Build CSV content
        let csvContent = headers.map(escapeCSV).join(',') + '\n';
        
        // Add data rows
        workEntries.forEach(entry => {
          let row;
          if (entry.type === 'aux') {
            row = [
              'Aux',
              entry.aux,
              '',
              '',
              '',
              '',
              '',
              '',
              entry.duration,
              entry.comments || '',
              entry.timestamp
            ];
          } else {
            row = [
              'Case',
              entry.aux,
              entry.pstam,
              entry.caseid,
              entry.stime,
              entry.etime,
              entry.cs,
              entry.acht,
              '',
              '',
              entry.timestamp
            ];
          }
          csvContent += row.map(escapeCSV).join(',') + '\n';
        });
        
        // Create filename with current date and time
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const filename = `work-tracker-${year}-${month}-${day}.csv`;
        
        // Create blob and download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        
        // Show success message
        showDownloadMessage('success', `CSV file "${filename}" has been downloaded successfully!`);
        
        // Cleanup
        setTimeout(() => {
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }, 100);
      } catch (error) {
        console.error('Export error:', error);
        showDownloadMessage('error', 'Failed to download CSV. Please try again.');
      }
    }

    // Show download message
    function showDownloadMessage(type, message) {
      // Remove existing message if any
      const existingMsg = document.getElementById('download-message');
      if (existingMsg) {
        existingMsg.remove();
      }

      const msgDiv = document.createElement('div');
      msgDiv.id = 'download-message';
      msgDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: var(--space-16);
        border-radius: var(--radius-base);
        box-shadow: var(--shadow-lg);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: var(--space-12);
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
      `;

      if (type === 'success') {
        msgDiv.style.backgroundColor = 'var(--color-bg-3)';
        msgDiv.style.border = '1px solid rgba(var(--color-success-rgb), 0.3)';
        msgDiv.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span style="color: var(--color-text); font-size: var(--font-size-sm);">${message}</span>
        `;
      } else {
        msgDiv.style.backgroundColor = 'var(--color-bg-4)';
        msgDiv.style.border = '1px solid rgba(var(--color-error-rgb), 0.3)';
        msgDiv.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-error)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span style="color: var(--color-text); font-size: var(--font-size-sm);">${message}</span>
        `;
      }

      document.body.appendChild(msgDiv);

      // Auto remove after 5 seconds
      setTimeout(() => {
        msgDiv.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => msgDiv.remove(), 300);
      }, 5000);
    }

    // Export button event listeners
    document.getElementById('export-csv-btn').addEventListener('click', exportToCSV);
    document.getElementById('user-export-btn').addEventListener('click', exportToCSV);

    // Before unload warning - warn user if there's unsaved data
    window.addEventListener('beforeunload', function(e) {
      if (workEntries.length > 0) {
        e.preventDefault();
        e.returnValue = '';
        return 'You have unsaved data. Please export before leaving!';
      }
    });

    // Initial render
    updatePstamFilter();
    // Don't render table and report initially - wait for unlock
  </script>
</body>
</html>